//     wink-nlp
//
//     Copyright (C) GRAYPE Systems Private Limited
//
//     This file is part of “wink-nlp”.
//
//     Permission is hereby granted, free of charge, to any
//     person obtaining a copy of this software and
//     associated documentation files (the "Software"), to
//     deal in the Software without restriction, including
//     without limitation the rights to use, copy, modify,
//     merge, publish, distribute, sublicense, and/or sell
//     copies of the Software, and to permit persons to
//     whom the Software is furnished to do so, subject to
//     the following conditions:
//
//     The above copyright notice and this permission notice
//     shall be included in all copies or substantial
//     portions of the Software.
//
//     THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF
//     ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED
//     TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
//     PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
//     THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
//     DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF
//     CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
//     CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER
//     DEALINGS IN THE SOFTWARE.

//

/* eslint-disable no-console */

var chai = require( 'chai' );
var mocha = require( 'mocha' );
var winkNLP = require( '../src/wink-nlp.js' );
var model = require( './test-model/model.js' );
const vectors = require( './test-model/languages/cur/models/test-vectors.json' );

var expect = chai.expect;
var describe = mocha.describe;
var it = mocha.it;

describe( 'contextual vectors', function () {
  var nlp = winkNLP( model, undefined, vectors );

  const text1 = 'It is';
  const doc1 = nlp.readDoc( text1 );
  const jsonWithDefault = '{"precision":8,"l2NormIndex":100,"wordIndex":101,"dimensions":100,"unkVector":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],"size":3,"words":["is","it","be"],"vectors":{"it":[-0.30664,0.16821,0.98511,-0.33606,-0.2416,0.16186,-0.053496,0.4301,0.57342,-0.071569,0.36101,0.26729,0.27789,-0.072268,0.13838,-0.26714,0.12999,0.22949,-0.18311,0.50163,0.44921,-0.020821,0.42642,-0.068762,0.40337,0.095198,-0.31944,-0.54651,-0.13345,-0.56511,-0.20975,1.1592,-0.194,0.19828,-0.11924,0.41781,0.0068383,-0.20537,-0.53375,-0.52225,-0.38227,-0.0065833,0.14265,-0.42502,-0.3115,0.0027352,0.75093,-0.48218,-0.18595,-0.77104,-0.046406,-0.06914,0.41688,1.3235,-0.81742,-3.3998,-0.11307,-0.34123,2.0775,0.61369,0.14792,0.93753,-0.10138,0.28426,0.97899,-0.32335,0.63697,0.58308,0.2282,-0.31696,0.21061,-0.6506,0.21653,-0.24347,0.55519,-0.34351,-0.095093,-0.14715,-1.2876,0.3931,0.30163,-0.21767,-1.1146,0.51349,-1.341,-0.30381,0.32499,-0.45236,-0.17743,-0.048504,-0.12178,-0.42108,-0.40327,0.038452,-0.36084,0.037738,-0.21885,-0.38775,0.36916,0.54521,6.1432065,1],"is":[-0.54264,0.41476,1.0322,-0.40244,0.46691,0.21816,-0.074864,0.47332,0.080996,-0.22079,-0.12808,-0.1144,0.50891,0.11568,0.028211,-0.3628,0.43823,0.047511,0.20282,0.49857,-0.10068,0.13269,0.16972,0.11653,0.31355,0.25713,0.092783,-0.56826,-0.52975,-0.051456,-0.67326,0.92533,0.2693,0.22734,0.66365,0.26221,0.19719,0.2609,0.18774,-0.3454,-0.42635,0.13975,0.56338,-0.56907,0.12398,-0.12894,0.72484,-0.26105,-0.26314,-0.43605,0.078908,-0.84146,0.51595,1.3997,-0.7646,-3.1453,-0.29202,-0.31247,1.5129,0.52435,0.21456,0.42452,-0.088411,-0.17805,1.1876,0.10579,0.76571,0.21914,0.35824,-0.11636,0.093261,-0.62483,-0.21898,0.21796,0.74056,-0.43735,0.14343,0.14719,-1.1605,-0.050508,0.12677,-0.014395,-0.98676,-0.091297,-1.2054,-0.11974,0.047847,-0.54001,0.52457,-0.70963,-0.32528,-0.1346,-0.41314,0.33435,-0.0072412,0.32253,-0.044219,-1.2969,0.76217,0.46349,5.97709161,0],"be":[-0.46953,0.38432,0.54833,-0.63401,0.010133,0.11364,0.10612,0.58529,0.032302,-0.12274,0.030265,0.52662,1.0398,-0.082143,0.19118,-0.83784,0.50763,0.44488,-0.72604,0.036893,0.24211,-0.28878,0.33657,0.13656,0.14579,-0.13221,0.098428,-0.45276,-0.13029,0.015762,-0.010161,0.4967,-0.28461,0.29655,0.92979,0.42447,-0.082773,0.30438,-0.39219,-0.30585,-0.43201,-0.27333,0.24388,-0.58081,0.22679,0.027226,0.53473,-0.37527,-0.16119,-1.1235,0.12768,-0.69898,0.41341,1.2291,-0.41248,-2.5173,-0.15354,-0.043107,1.9111,0.80754,-0.14759,0.9609,-0.84267,0.084422,1.2616,-0.10938,0.54846,0.75255,-0.071289,-0.73987,0.094808,-0.97589,0.0078721,-0.23928,0.2882,-0.41516,0.034366,0.1197,-1.2142,-0.11306,0.52847,-0.42273,-0.93378,-0.046645,-2.122,-0.341,0.64229,-0.10097,-0.22875,-1.0776,-0.68044,-0.26372,-0.18331,-0.051632,-0.30836,0.066537,0.20422,-0.68914,0.4511,0.25125,6.2325238,2]}}';
  const jsonWithFF0E = '{"precision":8,"l2NormIndex":100,"wordIndex":101,"dimensions":100,"unkVector":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],"size":2,"words":["is","it"],"vectors":{"it":[-0.30664,0.16821,0.98511,-0.33606,-0.2416,0.16186,-0.053496,0.4301,0.57342,-0.071569,0.36101,0.26729,0.27789,-0.072268,0.13838,-0.26714,0.12999,0.22949,-0.18311,0.50163,0.44921,-0.020821,0.42642,-0.068762,0.40337,0.095198,-0.31944,-0.54651,-0.13345,-0.56511,-0.20975,1.1592,-0.194,0.19828,-0.11924,0.41781,0.0068383,-0.20537,-0.53375,-0.52225,-0.38227,-0.0065833,0.14265,-0.42502,-0.3115,0.0027352,0.75093,-0.48218,-0.18595,-0.77104,-0.046406,-0.06914,0.41688,1.3235,-0.81742,-3.3998,-0.11307,-0.34123,2.0775,0.61369,0.14792,0.93753,-0.10138,0.28426,0.97899,-0.32335,0.63697,0.58308,0.2282,-0.31696,0.21061,-0.6506,0.21653,-0.24347,0.55519,-0.34351,-0.095093,-0.14715,-1.2876,0.3931,0.30163,-0.21767,-1.1146,0.51349,-1.341,-0.30381,0.32499,-0.45236,-0.17743,-0.048504,-0.12178,-0.42108,-0.40327,0.038452,-0.36084,0.037738,-0.21885,-0.38775,0.36916,0.54521,6.1432065,1],"is":[-0.54264,0.41476,1.0322,-0.40244,0.46691,0.21816,-0.074864,0.47332,0.080996,-0.22079,-0.12808,-0.1144,0.50891,0.11568,0.028211,-0.3628,0.43823,0.047511,0.20282,0.49857,-0.10068,0.13269,0.16972,0.11653,0.31355,0.25713,0.092783,-0.56826,-0.52975,-0.051456,-0.67326,0.92533,0.2693,0.22734,0.66365,0.26221,0.19719,0.2609,0.18774,-0.3454,-0.42635,0.13975,0.56338,-0.56907,0.12398,-0.12894,0.72484,-0.26105,-0.26314,-0.43605,0.078908,-0.84146,0.51595,1.3997,-0.7646,-3.1453,-0.29202,-0.31247,1.5129,0.52435,0.21456,0.42452,-0.088411,-0.17805,1.1876,0.10579,0.76571,0.21914,0.35824,-0.11636,0.093261,-0.62483,-0.21898,0.21796,0.74056,-0.43735,0.14343,0.14719,-1.1605,-0.050508,0.12677,-0.014395,-0.98676,-0.091297,-1.2054,-0.11974,0.047847,-0.54001,0.52457,-0.70963,-0.32528,-0.1346,-0.41314,0.33435,-0.0072412,0.32253,-0.044219,-1.2969,0.76217,0.46349,5.97709161,0]}}';
  const jsonWithTT0E = '{"precision":8,"l2NormIndex":100,"wordIndex":101,"dimensions":100,"unkVector":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],"size":5,"words":["is","it","be","not","this"],"vectors":{"it":[-0.30664,0.16821,0.98511,-0.33606,-0.2416,0.16186,-0.053496,0.4301,0.57342,-0.071569,0.36101,0.26729,0.27789,-0.072268,0.13838,-0.26714,0.12999,0.22949,-0.18311,0.50163,0.44921,-0.020821,0.42642,-0.068762,0.40337,0.095198,-0.31944,-0.54651,-0.13345,-0.56511,-0.20975,1.1592,-0.194,0.19828,-0.11924,0.41781,0.0068383,-0.20537,-0.53375,-0.52225,-0.38227,-0.0065833,0.14265,-0.42502,-0.3115,0.0027352,0.75093,-0.48218,-0.18595,-0.77104,-0.046406,-0.06914,0.41688,1.3235,-0.81742,-3.3998,-0.11307,-0.34123,2.0775,0.61369,0.14792,0.93753,-0.10138,0.28426,0.97899,-0.32335,0.63697,0.58308,0.2282,-0.31696,0.21061,-0.6506,0.21653,-0.24347,0.55519,-0.34351,-0.095093,-0.14715,-1.2876,0.3931,0.30163,-0.21767,-1.1146,0.51349,-1.341,-0.30381,0.32499,-0.45236,-0.17743,-0.048504,-0.12178,-0.42108,-0.40327,0.038452,-0.36084,0.037738,-0.21885,-0.38775,0.36916,0.54521,6.1432065,1],"is":[-0.54264,0.41476,1.0322,-0.40244,0.46691,0.21816,-0.074864,0.47332,0.080996,-0.22079,-0.12808,-0.1144,0.50891,0.11568,0.028211,-0.3628,0.43823,0.047511,0.20282,0.49857,-0.10068,0.13269,0.16972,0.11653,0.31355,0.25713,0.092783,-0.56826,-0.52975,-0.051456,-0.67326,0.92533,0.2693,0.22734,0.66365,0.26221,0.19719,0.2609,0.18774,-0.3454,-0.42635,0.13975,0.56338,-0.56907,0.12398,-0.12894,0.72484,-0.26105,-0.26314,-0.43605,0.078908,-0.84146,0.51595,1.3997,-0.7646,-3.1453,-0.29202,-0.31247,1.5129,0.52435,0.21456,0.42452,-0.088411,-0.17805,1.1876,0.10579,0.76571,0.21914,0.35824,-0.11636,0.093261,-0.62483,-0.21898,0.21796,0.74056,-0.43735,0.14343,0.14719,-1.1605,-0.050508,0.12677,-0.014395,-0.98676,-0.091297,-1.2054,-0.11974,0.047847,-0.54001,0.52457,-0.70963,-0.32528,-0.1346,-0.41314,0.33435,-0.0072412,0.32253,-0.044219,-1.2969,0.76217,0.46349,5.97709161,0],"be":[-0.46953,0.38432,0.54833,-0.63401,0.010133,0.11364,0.10612,0.58529,0.032302,-0.12274,0.030265,0.52662,1.0398,-0.082143,0.19118,-0.83784,0.50763,0.44488,-0.72604,0.036893,0.24211,-0.28878,0.33657,0.13656,0.14579,-0.13221,0.098428,-0.45276,-0.13029,0.015762,-0.010161,0.4967,-0.28461,0.29655,0.92979,0.42447,-0.082773,0.30438,-0.39219,-0.30585,-0.43201,-0.27333,0.24388,-0.58081,0.22679,0.027226,0.53473,-0.37527,-0.16119,-1.1235,0.12768,-0.69898,0.41341,1.2291,-0.41248,-2.5173,-0.15354,-0.043107,1.9111,0.80754,-0.14759,0.9609,-0.84267,0.084422,1.2616,-0.10938,0.54846,0.75255,-0.071289,-0.73987,0.094808,-0.97589,0.0078721,-0.23928,0.2882,-0.41516,0.034366,0.1197,-1.2142,-0.11306,0.52847,-0.42273,-0.93378,-0.046645,-2.122,-0.341,0.64229,-0.10097,-0.22875,-1.0776,-0.68044,-0.26372,-0.18331,-0.051632,-0.30836,0.066537,0.20422,-0.68914,0.4511,0.25125,6.2325238,2],"this":[-0.57058,0.44183,0.70102,-0.41713,-0.34058,0.02339,-0.071537,0.48177,-0.013121,0.16834,-0.13389,0.040626,0.15827,-0.44342,-0.019403,-0.009661,-0.046284,0.093228,-0.27331,0.2285,0.33089,-0.36474,0.078741,0.3585,0.44757,-0.2299,0.18077,-0.6265,0.053852,-0.29154,-0.4256,0.62903,0.14393,-0.046004,-0.21007,0.48879,-0.057698,0.37431,-0.030075,-0.34494,-0.29702,0.15095,0.28248,-0.16578,0.076131,-0.093016,0.79365,-0.60489,-0.18874,-1.0173,0.31962,-0.16344,0.54177,1.1725,-0.47875,-3.3842,-0.081301,-0.3528,1.8372,0.44516,-0.52666,0.99786,-0.32178,0.033462,1.1783,-0.072905,0.39737,0.26166,0.33111,-0.35629,-0.16558,-0.44382,-0.14183,-0.37976,0.28994,-0.029114,-0.35169,-0.27694,-1.344,0.19555,0.16887,0.040237,-0.80212,0.23366,-1.3837,-0.023132,0.085395,-0.74051,-0.073934,-0.58838,-0.085735,-0.10525,-0.51571,0.15038,-0.16694,-0.16372,-0.22702,-0.66102,0.47197,0.37253,5.85110816,4],"not":[-0.19104,0.17601,0.3692,-0.50323,-0.47561,0.15798,-0.11679,0.21052,0.32652,0.12194,0.090944,0.26089,0.76294,0.00069673,-0.050001,-0.44853,0.36239,0.56345,-0.68702,0.33237,0.31285,-0.14207,0.35327,-0.16426,-0.10693,0.077786,-0.17704,-0.92897,0.1468,-0.13585,0.25682,0.66019,-0.35569,0.21838,0.38173,0.54337,0.10197,0.3523,-0.2551,-0.15155,-0.67434,0.16903,0.16413,-0.53843,-0.17457,-0.28539,0.74044,-0.67533,-0.23382,-1.3599,0.30225,-0.14968,0.27043,1.1979,-0.29556,-2.5395,0.0010303,-0.26272,1.8303,0.80008,-0.35691,0.56578,-0.5504,0.070845,1.4275,0.09016,0.7842,0.7849,-0.33538,-0.65751,-0.20112,-1.0297,0.069195,-0.61272,0.11373,-0.19547,-0.21256,0.049763,-1.1619,-0.064512,0.53146,-0.47384,-0.68709,0.13024,-2.0899,-0.41346,0.30364,-0.00057448,-0.18833,-0.54779,-0.32058,-0.36704,-0.1474,-0.19044,-0.47712,0.048228,-0.26215,-0.5968,0.080843,0.27866,5.99066183,3]}}';
  const jsonWithTF0E = '{"precision":8,"l2NormIndex":100,"wordIndex":101,"dimensions":100,"unkVector":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,-1],"size":3,"words":["is","it","be"],"vectors":{"it":[-0.30664,0.16821,0.98511,-0.33606,-0.2416,0.16186,-0.053496,0.4301,0.57342,-0.071569,0.36101,0.26729,0.27789,-0.072268,0.13838,-0.26714,0.12999,0.22949,-0.18311,0.50163,0.44921,-0.020821,0.42642,-0.068762,0.40337,0.095198,-0.31944,-0.54651,-0.13345,-0.56511,-0.20975,1.1592,-0.194,0.19828,-0.11924,0.41781,0.0068383,-0.20537,-0.53375,-0.52225,-0.38227,-0.0065833,0.14265,-0.42502,-0.3115,0.0027352,0.75093,-0.48218,-0.18595,-0.77104,-0.046406,-0.06914,0.41688,1.3235,-0.81742,-3.3998,-0.11307,-0.34123,2.0775,0.61369,0.14792,0.93753,-0.10138,0.28426,0.97899,-0.32335,0.63697,0.58308,0.2282,-0.31696,0.21061,-0.6506,0.21653,-0.24347,0.55519,-0.34351,-0.095093,-0.14715,-1.2876,0.3931,0.30163,-0.21767,-1.1146,0.51349,-1.341,-0.30381,0.32499,-0.45236,-0.17743,-0.048504,-0.12178,-0.42108,-0.40327,0.038452,-0.36084,0.037738,-0.21885,-0.38775,0.36916,0.54521,6.1432065,1],"is":[-0.54264,0.41476,1.0322,-0.40244,0.46691,0.21816,-0.074864,0.47332,0.080996,-0.22079,-0.12808,-0.1144,0.50891,0.11568,0.028211,-0.3628,0.43823,0.047511,0.20282,0.49857,-0.10068,0.13269,0.16972,0.11653,0.31355,0.25713,0.092783,-0.56826,-0.52975,-0.051456,-0.67326,0.92533,0.2693,0.22734,0.66365,0.26221,0.19719,0.2609,0.18774,-0.3454,-0.42635,0.13975,0.56338,-0.56907,0.12398,-0.12894,0.72484,-0.26105,-0.26314,-0.43605,0.078908,-0.84146,0.51595,1.3997,-0.7646,-3.1453,-0.29202,-0.31247,1.5129,0.52435,0.21456,0.42452,-0.088411,-0.17805,1.1876,0.10579,0.76571,0.21914,0.35824,-0.11636,0.093261,-0.62483,-0.21898,0.21796,0.74056,-0.43735,0.14343,0.14719,-1.1605,-0.050508,0.12677,-0.014395,-0.98676,-0.091297,-1.2054,-0.11974,0.047847,-0.54001,0.52457,-0.70963,-0.32528,-0.1346,-0.41314,0.33435,-0.0072412,0.32253,-0.044219,-1.2969,0.76217,0.46349,5.97709161,0],"be":[-0.46953,0.38432,0.54833,-0.63401,0.010133,0.11364,0.10612,0.58529,0.032302,-0.12274,0.030265,0.52662,1.0398,-0.082143,0.19118,-0.83784,0.50763,0.44488,-0.72604,0.036893,0.24211,-0.28878,0.33657,0.13656,0.14579,-0.13221,0.098428,-0.45276,-0.13029,0.015762,-0.010161,0.4967,-0.28461,0.29655,0.92979,0.42447,-0.082773,0.30438,-0.39219,-0.30585,-0.43201,-0.27333,0.24388,-0.58081,0.22679,0.027226,0.53473,-0.37527,-0.16119,-1.1235,0.12768,-0.69898,0.41341,1.2291,-0.41248,-2.5173,-0.15354,-0.043107,1.9111,0.80754,-0.14759,0.9609,-0.84267,0.084422,1.2616,-0.10938,0.54846,0.75255,-0.071289,-0.73987,0.094808,-0.97589,0.0078721,-0.23928,0.2882,-0.41516,0.034366,0.1197,-1.2142,-0.11306,0.52847,-0.42273,-0.93378,-0.046645,-2.122,-0.341,0.64229,-0.10097,-0.22875,-1.0776,-0.68044,-0.26372,-0.18331,-0.051632,-0.30836,0.066537,0.20422,-0.68914,0.4511,0.25125,6.2325238,2]}}';

  it( 'with default parameters, size should be 3 & json should be correct', function () {
    const json = doc1.contextualVectors();
    const obj = JSON.parse( json );
    expect( obj ).to.deep.equal( JSON.parse( jsonWithDefault ) );
    expect( obj.size ).equal( 3 );
  } );

  it( 'with default lemma = false, size should be 2 & json should be correct', function () {
    const json = doc1.contextualVectors( { lemma: false } );
    const obj = JSON.parse( json );
    expect( obj ).to.deep.equal( JSON.parse( jsonWithFF0E ) );
    expect( obj.size ).equal( 2 );
  } );

  it( 'with default lemma = true, similarWordVector = true size should be 5 & json should be correct', function () {
    const json = doc1.contextualVectors( { lemma: true, similarWordVectors: true } );
    const obj = JSON.parse( json );
    expect( obj ).to.deep.equal( JSON.parse( jsonWithTT0E ) );
    expect( obj.size ).equal( 5 );
  } );

  it( 'with default lemma = true, similarWordVector = true size should be 3 & json should be correct', function () {
    const json = doc1.contextualVectors( { lemma: true, similarWordVectors: false } );
    const obj = JSON.parse( json );
    expect( obj ).to.deep.equal( JSON.parse( jsonWithTF0E ) );
    expect( obj.size ).equal( 3 );
  } );
} );
